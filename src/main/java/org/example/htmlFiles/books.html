<!DOCTYPE html>
<html>
<head>
    <title>Books</title>
</head>
<body>
<h1>Books</h1>

<table>
    <thead>
    <tr>
        <th>Code</th>
        <th>Title</th>
        <th>Author</th>
        <th>Quantity</th>
    </tr>
    </thead>
    <tbody id="book-list">
    </tbody>
</table>

<h2>Add New Book</h2>
<form id="add-book-form">
    <label for="code">Code:</label>
    <input type="text" id="code" name="code" required><br><br>

    <label for="title">Title:</label>
    <input type="text" id="title" name="title" required><br><br>

    <label for="author">Author:</label>
    <input type="text" id="author" name="author" required><br><br>

    <label for="quantity">Quantity:</label>
    <input type="number" id="quantity" name="quantity" required><br><br>

    <button type="submit">Add Book</button>
</form>

<script>
    // Fetch book data and populate the table
    function loadBooks() {
        fetch('/books')
            .then(response => response.json())
            .then(books => {
                const bookList = document.getElementById('book-list');
                bookList.innerHTML = ''; // Clear existing data
                books.forEach(book => {
                    const row = bookList.insertRow();
                    row.insertCell().textContent = book.code;
                    row.insertCell().textContent = book.title;
                    row.insertCell().textContent = book.author;
                    row.insertCell().textContent = book.quantity;
                });
            });
    }

    // Handle form submission
    document.getElementById('add-book-form').addEventListener('submit', function(event) {
        event.preventDefault(); // Prevent default form submission

        const form = event.target;
        fetch(form.action, {
            method: form.method,
            body: new URLSearchParams(new FormData(form)) // Encode form data
        })
            .then(response => {
                if (response.ok) {
                    loadBooks(); // Reload book data
                    form.reset(); // Clear the form
                } else {
                    alert('Error adding book: ' + response.status);
                }
            });
    });

    // Initial load
    loadBooks();
</script>
</body>
</html>